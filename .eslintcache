[{"D:\\Internshala\\ghap-shap\\src\\index.js":"1","D:\\Internshala\\ghap-shap\\src\\App.js":"2","D:\\Internshala\\ghap-shap\\src\\components\\PrivateRoute.js":"3","D:\\Internshala\\ghap-shap\\src\\Pages\\SignIn.js":"4","D:\\Internshala\\ghap-shap\\src\\components\\PublicRoute.js":"5","D:\\Internshala\\ghap-shap\\src\\misc\\Firebase.js":"6","D:\\Internshala\\ghap-shap\\src\\context\\profile.context.js":"7","D:\\Internshala\\ghap-shap\\src\\components\\SideBar.js":"8","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\DashboardToggle.js":"9","D:\\Internshala\\ghap-shap\\src\\misc\\CustomHook.js":"10","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\index.js":"11","D:\\Internshala\\ghap-shap\\src\\components\\EditableInput.js":"12","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\ProviderBlock.js":"13","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\AvatarUpload.js":"14","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\ProfileAvatar.js":"15","D:\\Internshala\\ghap-shap\\src\\misc\\Helper.js":"16","D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\CreateChatRoomBtn.js":"17","D:\\Internshala\\ghap-shap\\src\\components\\Room\\ChatRoomList.js":"18","D:\\Internshala\\ghap-shap\\src\\components\\Room\\RoomItem.js":"19","D:\\Internshala\\ghap-shap\\src\\context\\Rooms.context.js":"20","D:\\Internshala\\ghap-shap\\src\\Pages\\Home\\index.js":"21","D:\\Internshala\\ghap-shap\\src\\Pages\\Home\\Chat.js":"22","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\index.js":"23","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\index.js":"24","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\index.js":"25","D:\\Internshala\\ghap-shap\\src\\context\\Current-room.context.js":"26","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\RoomInfo.js":"27","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\MessageItems.js":"28","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\ProfileInfoBtn.js":"29","D:\\Internshala\\ghap-shap\\src\\components\\PresenceDot.js":"30","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\EditRoomBtn.js":"31","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\IconBtnControl.js":"32","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\AttachmentBtn.js":"33","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\ImgBtnModal.js":"34","D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\AudioMsgBtn.js":"35"},{"size":496,"mtime":1607414741870,"results":"36","hashOfConfig":"37"},{"size":654,"mtime":1607859676912,"results":"38","hashOfConfig":"37"},{"size":614,"mtime":1607433013173,"results":"39","hashOfConfig":"37"},{"size":1736,"mtime":1608013890292,"results":"40","hashOfConfig":"37"},{"size":594,"mtime":1607427841332,"results":"41","hashOfConfig":"37"},{"size":613,"mtime":1607585650636,"results":"42","hashOfConfig":"37"},{"size":2344,"mtime":1608023167633,"results":"43","hashOfConfig":"37"},{"size":802,"mtime":1607621129686,"results":"44","hashOfConfig":"37"},{"size":1163,"mtime":1608023088556,"results":"45","hashOfConfig":"37"},{"size":1956,"mtime":1608135751325,"results":"46","hashOfConfig":"37"},{"size":1383,"mtime":1608298393250,"results":"47","hashOfConfig":"37"},{"size":1399,"mtime":1607445688191,"results":"48","hashOfConfig":"37"},{"size":2414,"mtime":1607505327013,"results":"49","hashOfConfig":"37"},{"size":3581,"mtime":1608129284343,"results":"50","hashOfConfig":"37"},{"size":247,"mtime":1607712091873,"results":"51","hashOfConfig":"37"},{"size":1516,"mtime":1608380799955,"results":"52","hashOfConfig":"37"},{"size":2992,"mtime":1608128419663,"results":"53","hashOfConfig":"37"},{"size":1013,"mtime":1607676526092,"results":"54","hashOfConfig":"37"},{"size":1241,"mtime":1608314231757,"results":"55","hashOfConfig":"37"},{"size":687,"mtime":1607623783387,"results":"56","hashOfConfig":"37"},{"size":1263,"mtime":1607686935756,"results":"57","hashOfConfig":"37"},{"size":1401,"mtime":1608137714094,"results":"58","hashOfConfig":"37"},{"size":3078,"mtime":1608316476647,"results":"59","hashOfConfig":"37"},{"size":1317,"mtime":1608128418126,"results":"60","hashOfConfig":"37"},{"size":4589,"mtime":1608387793203,"results":"61","hashOfConfig":"37"},{"size":407,"mtime":1607929123547,"results":"62","hashOfConfig":"37"},{"size":908,"mtime":1607930775715,"results":"63","hashOfConfig":"37"},{"size":2876,"mtime":1608317121077,"results":"64","hashOfConfig":"37"},{"size":1166,"mtime":1608312650162,"results":"65","hashOfConfig":"37"},{"size":920,"mtime":1608031613275,"results":"66","hashOfConfig":"37"},{"size":2117,"mtime":1608045275295,"results":"67","hashOfConfig":"37"},{"size":717,"mtime":1608301564534,"results":"68","hashOfConfig":"37"},{"size":2513,"mtime":1608315731660,"results":"69","hashOfConfig":"37"},{"size":835,"mtime":1608313912628,"results":"70","hashOfConfig":"37"},{"size":1621,"mtime":1608316570046,"results":"71","hashOfConfig":"37"},{"filePath":"72","messages":"73","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},"1j2jkwb",{"filePath":"75","messages":"76","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"81","messages":"82","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"83","messages":"84","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"85","messages":"86","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"87","messages":"88","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"89","messages":"90","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"91","messages":"92","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"93","messages":"94","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"95","messages":"96","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"97"},{"filePath":"98","messages":"99","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"100","messages":"101","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"102","messages":"103","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"104","messages":"105","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"106","messages":"107","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"108","messages":"109","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"110","messages":"111","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"112","messages":"113","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"114","messages":"115","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"116","messages":"117","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"118","messages":"119","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"120","messages":"121","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"122","messages":"123","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"124","usedDeprecatedRules":"74"},{"filePath":"125","messages":"126","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"127","messages":"128","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"129","messages":"130","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"131","messages":"132","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"133","messages":"134","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"135","messages":"136","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"137","messages":"138","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"139","messages":"140","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"141","messages":"142","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},{"filePath":"143","messages":"144","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"74"},"D:\\Internshala\\ghap-shap\\src\\index.js",[],["145","146","147","148","149"],"D:\\Internshala\\ghap-shap\\src\\App.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\PrivateRoute.js",[],"D:\\Internshala\\ghap-shap\\src\\Pages\\SignIn.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\PublicRoute.js",[],"D:\\Internshala\\ghap-shap\\src\\misc\\Firebase.js",[],"D:\\Internshala\\ghap-shap\\src\\context\\profile.context.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\SideBar.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\DashboardToggle.js",[],"D:\\Internshala\\ghap-shap\\src\\misc\\CustomHook.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\index.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\EditableInput.js",[],["150","151","152","153","154"],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\ProviderBlock.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\AvatarUpload.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\ProfileAvatar.js",[],"D:\\Internshala\\ghap-shap\\src\\misc\\Helper.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Dashboard\\CreateChatRoomBtn.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Room\\ChatRoomList.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\Room\\RoomItem.js",[],"D:\\Internshala\\ghap-shap\\src\\context\\Rooms.context.js",[],"D:\\Internshala\\ghap-shap\\src\\Pages\\Home\\index.js",[],"D:\\Internshala\\ghap-shap\\src\\Pages\\Home\\Chat.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\index.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\index.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\index.js",["155"],"import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useParams } from 'react-router';\r\nimport { Alert, Button } from 'rsuite';\r\nimport { database, storage } from '../../../misc/Firebase';\r\nimport { groupBy, transformtoarrwithid } from '../../../misc/Helper';\r\nimport { MessageItems } from './MessageItems';\r\n\r\nconst PAGE_SIZE = 15;\r\nconst messagesRef = database.ref('/messages');\r\n\r\nconst shouldScrolltobottom=(node,threshold=30)=>{\r\n  const percentage=(100*node.scrollTop)/(node.scrollHeight-node.clientHeight) || 0;\r\n  return percentage>threshold;\r\n}\r\n\r\nconst Messages = () => {\r\n  const [messages, setMessages] = useState();\r\n  const { chatId } = useParams();\r\n  const isChatEmpty = messages && messages.length === 0;\r\n  const canShowMessages = messages && messages.length > 0;\r\n  const [limit, setLimit] = useState(PAGE_SIZE);\r\n  const selfRef = useRef();\r\n  const loadMessages = useCallback(\r\n    limitToLast => {\r\n      messagesRef.off();\r\n      messagesRef\r\n        .orderByChild('roomId')\r\n        .equalTo(chatId)\r\n        .limitToLast(limitToLast || PAGE_SIZE)\r\n        .on('value', snap => {\r\n          const date = transformtoarrwithid(snap.val());\r\n          setMessages(date);\r\n          const node=selfRef.current\r\n          if(shouldScrolltobottom(node)){\r\n            node.scrollTop=node.scrollHeight;\r\n          }\r\n        });\r\n      setLimit(p => p + PAGE_SIZE);\r\n    },\r\n    [chatId]\r\n  );\r\n\r\n  const onLoadMore = useCallback(() => {\r\n    const node=selfRef.current\r\n    const oldHeight=node.scrollHeight\r\n    loadMessages(limit);\r\n    setTimeout(() => {\r\n      const newHeight=node.scrollHeight;\r\n      node.scrollTop=newHeight-oldHeight\r\n    }, 400);\r\n  }, [loadMessages, limit]);\r\n  useEffect(() => {\r\n    const node = selfRef.current;\r\n    loadMessages();\r\n    setTimeout(() => {\r\n      node.scrollTop = node.scrollHeight;\r\n    }, 400);\r\n    return () => {\r\n      messagesRef.off('value');\r\n    };\r\n  }, [loadMessages]);\r\n  const handleAdmin = useCallback(\r\n    async uid => {\r\n      const adminRef = database.ref(`/rooms/${chatId}/admins`);\r\n      let alertMsg;\r\n      await adminRef.transaction(admins => {\r\n        if (admins) {\r\n          if (admins[uid]) {\r\n            admins[uid] = null;\r\n            alertMsg = 'Admin permission removed';\r\n          } else {\r\n            admins[uid] = true;\r\n            alertMsg = 'Admin permission granted';\r\n          }\r\n        }\r\n        return admins;\r\n      });\r\n      Alert.success(alertMsg, 4000);\r\n    },\r\n    [chatId]\r\n  );\r\n  const handleDelete = useCallback(\r\n    async (msgId, file) => {\r\n      if (!window.confirm('delete this message ?')) {\r\n        return;\r\n      }\r\n      const isLast = messages[messages.length - 1].id === msgId;\r\n      const updates = {};\r\n      updates[`/messages/${msgId}`] = null;\r\n      if (isLast && messages.length > 1) {\r\n        updates[`/rooms/${chatId}/lastMessage`] = {\r\n          ...messages[messages.length - 2],\r\n          msgId: messages[messages.length - 2].id,\r\n        };\r\n      }\r\n      if (isLast && messages.length === 1) {\r\n        updates[`/rooms/${chatId}/lastMessage`] = null;\r\n      }\r\n      try {\r\n        await database.ref().update(updates);\r\n      } catch (error) {\r\n        Alert.error(error.message, 4000);\r\n      }\r\n\r\n      if (file) {\r\n        try {\r\n          const fileRef = storage.refFromURL(file.url);\r\n          await fileRef.delete();\r\n        } catch (error) {\r\n          Alert.error(error.message, 4000);\r\n        }\r\n      }\r\n    },\r\n    [chatId, messages]\r\n  );\r\n\r\n  const renderMessages = () => {\r\n    const groups = groupBy(messages, item =>\r\n      new Date(item.createdAt).toDateString()\r\n    );\r\n    const items = [];\r\n    Object.keys(groups).forEach(date => {\r\n      items.push(\r\n        <li key={date} className=\"text-center mb-1 padded\">\r\n          {date}\r\n        </li>\r\n      );\r\n      const msgs = groups[date].map(msg => (\r\n        <MessageItems\r\n          key={msg.id}\r\n          message={msg}\r\n          handleAdmin={handleAdmin}\r\n          handleDelete={handleDelete}\r\n        />\r\n      ));\r\n      items.push(...msgs);\r\n    });\r\n    return items;\r\n  };\r\n\r\n  return (\r\n    <ul ref={selfRef} className=\"msg-list custom-scroll\">\r\n      {messages && messages.length >= PAGE_SIZE && (\r\n        <li className=\"text-center mt-2 mb-2\">\r\n          <Button onClick={onLoadMore} color=\"green\">\r\n            Load more\r\n          </Button>\r\n        </li>\r\n      )}\r\n      {isChatEmpty && <li>No messages yet..</li>}\r\n      {canShowMessages && renderMessages()}\r\n    </ul>\r\n  );\r\n};\r\n\r\nexport default Messages;\r\n","D:\\Internshala\\ghap-shap\\src\\context\\Current-room.context.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\RoomInfo.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\MessageItems.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\ProfileInfoBtn.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\PresenceDot.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\top\\EditRoomBtn.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\IconBtnControl.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\AttachmentBtn.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\messages\\ImgBtnModal.js",[],"D:\\Internshala\\ghap-shap\\src\\components\\chat-window\\bottom\\AudioMsgBtn.js",[],{"ruleId":"156","replacedBy":"157"},{"ruleId":"158","replacedBy":"159"},{"ruleId":"160","replacedBy":"161"},{"ruleId":"162","replacedBy":"163"},{"ruleId":"164","replacedBy":"165"},{"ruleId":"156","replacedBy":"166"},{"ruleId":"158","replacedBy":"167"},{"ruleId":"160","replacedBy":"168"},{"ruleId":"162","replacedBy":"169"},{"ruleId":"164","replacedBy":"170"},{"ruleId":"171","severity":1,"message":"172","line":84,"column":12,"nodeType":"173","messageId":"174","endLine":84,"endColumn":51},"lines-around-directive",["175"],"global-require",[],"no-buffer-constructor",[],"no-new-require",[],"no-path-concat",[],["175"],[],[],[],[],"no-alert","Unexpected confirm.","CallExpression","unexpected","padding-line-between-statements"]